#include <Wire.h>
#include <math.h>
#include <Adafruit_Sensor.h>
#include <Adafruit_BNO055.h>
#include <utility/imumaths.h>
#include "SD.h"
#define SD_ChipSelectPin 10
#include "TMRpcm.h"
#include "SPI.h"

TMRpcm audio;

int buttonPin; // Declaring the Read Button

Adafruit_BNO055 bno = Adafruit_BNO055(55);

void loop(void) 
{
  /* Get a new sensor event */
  sensors_event_t event;
  bno.getEvent(&event);
  double  xpos = event.orientation.x;
  double ypos = event.orientation.y;
  double  zpos = event.orientation.z; // Declare original pos values
  String xposhunddig, xposhundteendig, xpostensdig, xposonesdig, xposdecdig; //Declaring the digit values of the original pos values


  /* Display the floating point data */
  Serial.print("X: ");
  Serial.print(event.orientation.x, 1);
  Serial.print("\tY: ");
  // Serial.print(event.orientation.y, 1);
  Serial.print("\tZ: ");
  // Serial.print(event.orientation.z, 1);

  
  /* Optional: Display calibration status */
  displayCalStatus();

  /* Optional: Display sensor status (debug only) */
  //displaySensorStatus();

  /* New line for the next sample */
  Serial.println("");

  /* Wait the specified delay before requesting nex data */
  delay(BNO055_SAMPLERATE_DELAY_MS);


  buttonPin=digitalRead(2);
  xpos = event.orientation.x;
  ypos = event.orientation.y;
  zpos = event.orientation.z; // Create doubles with the variables give
  if(buttonPin == LOW) //If the read button is pushed
    { 
      xposdecdig = String(String(fmod(xpos,1) * 10) +".wav"); // First digit decimal file
      char decimal[xposdecdig.length()+1]; // Declare the Char Matrix of File
      xposdecdig.toCharArray(decimal, sizeof(decimal)); // Convert File to Char Array
      
      if (xpos >= 100)
     //If angle is 100 or higher
      {
          xposhunddig = String(String(xpos - fmod(xpos,100)) + ".wav"); // 100 file
          xpostensdig = String(String(fmod(xpos,100) - fmod(xpos,10)) + ".wav"); // 10 file
          xposhundteendig = String(String(fmod(xpos,100) - (fmod(xpos,1))) + ".wav"); // Teens file
          xposonesdig = String(String(fmod(xpos,10) - fmod(xpos,1)) + ".wav"); // 1 file
          
          char hundreds[xposhunddig.length()+1]; // Declare the Char Matrix of File
          xposhunddig.toCharArray(hundreds, sizeof(hundreds)); // Convert File to Char Array

          char tens[xpostensdig.length()+1]; // Declare the Char Matrix of File
          xpostensdig.toCharArray(tens, sizeof(tens)); // Convert File to Char Array

          char teens[xposhundteendig.length()+1]; // Declare the Char Matrix of File
          xposhundteendig.toCharArray(teens, sizeof(teens)); // Convert File to Char Array

          char ones[xposonesdig.length()+1]; // Declare the Char Matrix of File
          xposonesdig.toCharArray(ones, sizeof(ones)); // Convert File to Char Array
          

          if (((fmod(xpos,10) - fmod(xpos,1))!= 0) && (((fmod(xpos,100) - fmod(xpos,10)) != 0) || ((fmod(xpos,100) - fmod(xpos,10)) != 1)))  
          //if 1s digit is not 0 and 10s digit is not 0 or 1
          {
            audio.play(hundreds); // Play 100s File
            audio.play(tens); // Play 10s File
            audio.play(ones); // Play 1s File
            audio.play("point.wav");
            audio.play(decimal); // Play Decimal File
          }
          else if (((fmod(xpos,10) - fmod(xpos,1))== 0) && (((fmod(xpos,100) - fmod(xpos,10)) != 0) || ((fmod(xpos,100) - fmod(xpos,10)) != 1))) 
          //if 1s digit is 0 and 10s digit is not 0 or 1
          {
            audio.play(hundreds); // Play 100s File
            audio.play(tens); // Play 10s File
            audio.play("point.wav");
            audio.play(decimal); // Play Decimal File
          }
          else if ((xpos>=110 && xpos<120) || (xpos>=210 && xpos<220) || (xpos>=310 && xpos<320)) //if the angle is a hundreds teens digit e.g (216,119)
         {
            audio.play(hundreds); // Play 100s File
            audio.play(teens); // Play 10s File
            audio.play("point.wav");
            audio.play(decimal); // Play Decimal File
         }
         else if ((xpos>=101 && xpos<110) || (xpos>=201 && xpos<210) || (xpos>=301 && xpos<310)) //if the angle is a hundred and a 1s digit e.g (101,305)
         {
            audio.play(hundreds); // Play 100s File
            audio.play(ones); // Play 10s File
            audio.play("point.wav");
            audio.play(decimal); // Play Decimal File
         }
         else if (((fmod(xpos,10) - fmod(xpos,1)) == 0) || ((fmod(xpos,100) - fmod(xpos,10)) == 0)) // if the 10s and 1s digit are 0 e.g (100,200)
         //If both 10s and 1s are 0
         {
            audio.play(hundreds); // Play 100s File
            audio.play("point.wav");
            audio.play(decimal); // Play Decimal File
         }
      }
      
      else if (xpos < 100 && xpos >= 20) // if the angle is less than 100 and greater than 20
         {
          xpostensdig = String(String(xpos - fmod(xpos,10)) + ".wav");
          xposonesdig = String(String(fmod(xpos,10) - fmod(xpos,1)) + ".wav");
          
          char tens[xpostensdig.length()+1]; // Declare the Char Matrix of File
          xpostensdig.toCharArray(tens, sizeof(tens)); // Convert File to Char Array
          
          char ones[xposonesdig.length()+1]; // Declare the Char Matrix of File
          xposonesdig.toCharArray(ones, sizeof(ones)); // Convert File to Char Array

          if((fmod(xpos,10) - fmod(xpos,1)) != 0) // If ones digit is not 0
          {
            audio.play(tens); // Play 10s File
            audio.play(ones); // Play 1s File
            audio.play("point.wav");
            audio.play(decimal); // Play Decimal File
          }
          else if (fmod(xpos,10) - fmod(xpos,1) == 0) // If ones digit is 0
          {
            audio.play(tens); // Play 10s File
            audio.play("point.wav");
            audio.play(decimal); // Play Decimal File
          }
       }
       
       else if ((xpos < 20) && (xpos >= 10)) //If the angle is in the teens
         {
          xpostensdig = String(String(xpos - fmod(xpos,1)) + ".wav");

          char tens[xpostensdig.length()+1]; // Declare the Char Matrix of File
          xpostensdig.toCharArray(tens, sizeof(tens)); // Convert File to Char Array

          
          audio.play(tens); // Play 10s File
          audio.play("point.wav");
          audio.play(decimal); // Play Decimal File
         }
       else if ((xpos <10) && (xpos >= 1)) // If angle is in the ones
         {
          xposonesdig = String(String(xpos - fmod(xpos,1)) +".wav");
    
          char ones[xposonesdig.length()+1]; // Declare the Char Matrix of File
          xposonesdig.toCharArray(ones, sizeof(ones)); // Convert File to Char Array
          
          audio.play(ones); // Play 1s File
          audio.play("point.wav");
          audio.play(decimal); // Play Decimal File
         }
       else if (xpos < 1) //if angle is just a decimal
       {   
          audio.play("point.wav");
          audio.play(decimal); // Play Decimal File
       }
    
    }
